//Name catch
const name_catch="Restaurant App";
// Cathc Files 
const files=[

    "/error",
    "/home",
    "/menu",
    "/gallery",    
    "/aboutUs",
    "/contactUs",
    "/API/sendEmail",
    "/API/message",
    "/getInfoUser",
    "/API/getInfoUser",
    "/API/read",
    "/API/create",
    "/API/delete",
    "/API/countReservation",
    // "https://unpkg.com/swiper/swiper-bundle.css ",
    // "https://unpkg.com/swiper/swiper-bundle.min.css",
    // "https://unpkg.com/swiper/swiper-bundle.js",
    // "https://unpkg.com/swiper/swiper-bundle.min.js",
    
    "/build/img/pexels-andrea-piacquadio-761854.webp",
    "/build/img/brick-wall-1834784_1920.webp",
    "/build/img/header.webp",
    "/build/img/history1.webp",
    "/build/img/history2.webp",
    "/build/img/image.webp",
    "/build/img/pexels-allan-franca-carmo-3465604.webp",
    "/build/img/pexels-anna-tis-6832690.webp",
    "/build/img/pexels-cottonbro-3338536.webp",
    "/build/img/pexels-cottonbro-4253302.webp",
    "/build/img/pexels-cottonbro-4255381.webp",
    "/build/img/pexels-cottonbro-4255412.webp",
    "/build/img/pexels-cottonbro-6718629.webp",
    "/build/img/pexels-daria-shevtsova-704569-removebg-preview.webp",
    "/build/img/pexels-daria-shevtsova-1095550-removebg-preview.webp",
    "/build/img/pexels-deeana-creates-2565222.webp",
    "/build/img/pexels-elevate-1267315.webp",
    "/build/img/pexels-emre-vonal-7741852.webp",
    "/build/img/pexels-jonathan-borba-2878741.webp",
    "/build/img/pexels-julie-aagaard-2097090.webp",
    "/build/img/pexels-karolina-grabowska-4397899.webp",
    "/build/img/pexels-kasumi-loffler-3535383.webp",
    "/build/img/pexels-ketut-subiyanto-4349785.webp",
    "/build/img/pexels-ketut-subiyanto-4473496.webp",
    "/build/img/pexels-lumn-568370.webp",
    "build/img/pexels-rachel-claire-5531434.webp",
    "/build/img/pexels-maria-orlova-4947396.webp",
    "/build/img/pexels-maria-orlova-4947550.webp",
    "/build/img/pexels-marion-pintaux-2670327.webp",
    "/build/img/pexels-mikotoraw-photographer-5763823.webp",
    "/build/img/pexels-miquel-ferran-gomez-figueroa-3814446.webp",
    "/build/img/pexels-pixabay-262047.webp",
    "/build/img/pexels-pixabay-265920.webp",
    "/build/img/pexels-ponyo-sakana-3662189.webp",
    "/build/img/pexels-rachel-claire-5490965.webp",
    "/build/img/pexels-rachel-claire-5490972.webp",
    "/build/img/pexels-rachel-claire-6126977.webp",
    "/build/img/pexels-rene-asmussen-2544829.webp",
    "/build/img/pexels-rene-asmussen-3217156.webp",
    "/build/img/pexels-roman-odintsov-4553612.webp",
    "/build/img/pexels-salah-alawadhi-382297.webp",
    "/build/img/pexels-samfotograffo-3052362.webp",
    "/build/img/pexels-sam-lion-5710170.webp",
    "/build/img/pexels-skitterphoto-9315.webp",
    "/build/img/pexels-viktoria-alipatova-2074130.webp",
    "/build/img/pexels-wendy-wei-2813132.webp",
    "/build/img/pexels-william-choquette-2641886.webp",
    "/build/img/platter-2009590_1920.webp",
    "/build/img/—Pngtree—floral and flower vector element_5518162 (1).png",
    "/build/img/—Pngtree—floral and flower vector element_5518953.png",
    "/build/img/roses.png",

    "/build/img/2-2-food-png-hd.png",
    "/build/img/2-pizza-png-image.png",
    "/build/img/4-2-food-png.png",
    "/build/img/5-2-sandwich-transparent.png",
    "/build/img/110829-chicken-fried-wings-png-image-high-quality.png",
    "/build/img/136327-barbecue-chicken-roasted-free-download-image.png",
    "/build/img/169254-fried-pic-free-clipart-hd.png",
    "/build/img/176608-popeyes-chicken-fried-crispy-png-free-photo.png",
    "/build/img/kisspng-baotou-ningxia-g7-beijingu2013xdcrxfcmqi-expresswa-pasta-stew-face-5a905cba2b77f3.9123339915194103621781.png",
    "/build/img/kisspng-bolognese-sauce-pizza-pasta-lasagne-buffalo-wing-spagetti-pasta-5ade9a97ae5096.715418231524538007714.png",
    "/build/img/kisspng-green-papaya-salad-thai-cuisine-salted-duck-egg-th-5af7e56da45769.9837689815261955656732.png",
    "/build/img/kisspng-hamburger-street-food-seafood-fast-food-delicious-food-5a75083cceaf41.2676743415176192608466.png",
    "/build/img/kisspng-lasagne-pasta-bolognese-sauce-spaghetti-recipe-pasta-italian-5b132ccd7d7371.5674962015279833095139.png",
    "/build/img/kisspng-pasta-salad-italian-cuisine-tuna-salad-fusilli-salad-5abc1685e07215.3033002815222759739193.png",
    "/build/img/kisspng-pescado-frito-ceviche-fried-fish-dish-egyptian-5ac58e27aab555.5367134115228964236992.png",
    "/build/img/kisspng-spaghetti-alla-puttanesca-pasta-italian-cuisine-pe-5aef2fbe8f0e50.177712581525624766586.png",
    "/build/img/kisspng-spaghetti-spinach-salad-shrimp-and-prawn-as-food-5b11918ba7a8d5.5272275715278780276868.png",
    "/build/img/pexels-daria-shevtsova-704569-removebg-preview.png",
    "/build/img/pexels-daria-shevtsova-1095550-removebg-preview.png",
    "/build/img/PNGPIX-COM-Food-Plate-PNG-Transparent-Image.png",
    "/build/img/PNGPIX-COM-Food-Plate-PNG-Transparent-Image-1.png",
    "/build/img/PNGPIX-COM-Junk-Food-PNG-Transparent-Image.png",
    "/build/img/punpun.png",
    "/build/img/logo(72).png",
    "/build/img/logo(120).png",
    "/build/img/logo(128).png",
    "/build/img/logo(144).png",
    "/build/img/logo(152).png",
    "/build/img/logo(196).png",
    "/build/img/logo(256).png",
    "/build/img/logo(512).png",
    
    "build/img/aboutUs.svg",
    "build/img/birdandchildframe.svg",
    "build/img/box.svg",
    "build/img/calendar.svg",
    "build/img/clock.svg",
    "build/img/contactUs.svg",
    "build/img/crown.svg",
    "build/img/delete.svg",
    "build/img/dots.svg",
    "build/img/easterlillies-frame.svg",
    "build/img/error.svg",
    "build/img/facebook.svg",
    "build/img/filter.svg",
    "build/img/gallery.svg",
    "build/img/home.svg",
    "build/img/id.svg",
    "build/img/info.svg",
    "build/img/instagram.svg",
    "build/img/instagram (1).svg",
    "build/img/instagram-icon.svg",
    "build/img/logOut.svg",
    "build/img/mail.svg",
    "build/img/map.svg",
    "build/img/menu.svg",
    "build/img/music.svg",
    "build/img/ok.svg",
    "build/img/parking.svg",
    "build/img/password.svg",
    "build/img/phone.svg",
    "build/img/plus.svg",
    "build/img/reserve.svg",
    "build/img/smokingZone.svg",
    "build/img/svg (3).svg",
    "build/img/svg (4).svg",
    "build/img/time-left (1).svg",
    "build/img/time-left.svg",
    "build/img/twitter.svg",
    "build/img/undraw_Login_re_4vu2.svg",
    "build/img/undraw_press_play_bx2d.svg",
    "build/img/undraw_special_event_4aj8.svg",
    "build/img/wifi.svg",

    "build/js/swiper.js",
    "build/js/swiper.min.js",
    "build/js/moment-with-locales.min.js",
    "build/js/pwa.js",
    "build/js/support.js",
    "build/js/app.js",

    "build/css/swiper.css",
    "build/css/swiper.min.css",
    "build/css/app.css"

];

// To install  a service worker we need use "self" and avoid use "this" 

self.addEventListener("install",async e =>{

        const cache = await caches.open(name_catch);
        await cache.addAll(files);
        try {
            return self.skipWaiting();    
        } catch (error) {
            console.log(error);;
        }
        
});

self.addEventListener("activate",e=>{
    self.clients.claim();
});

self.addEventListener('fetch', e => {

    if (e.request.method === 'GET' &&
    e.request.headers.get('accept').indexOf('text/html') !== -1){

        const req=e.request;
        const url= new URL(req.url);
    
        if(url.origin===location.origin){
            e.respondWith(cacheFirst(req));
        }else{
            e.respondWith(networkAndCache(req))
        }

    }

});

async function cacheFirst(req){

    const cache = await caches.open(name_catch);
    const cached = await cache.match(req);
    try {
        return cached || fetch(req);    
    } catch (e) {
        caches.match('/error')
    }
    

}

async function networkAndCache(req){
    const cache = await caches.open(name_catch);
    try {
        const fresh = await fetch(req);
        await cache.put(req, fresh.clone());
        return fresh;
        
    } catch (e) {
        const cached = await cache.match(req);
        try {
            return cached;    
        } catch (e) {
            caches.match('/error')
        }
        
    }
}

// self.addEventListener("install",e=>{
//     e.waitUntil(
//         caches.open(name_catch)
//             .then(cache=>{
//                 console.log("cacheando");
//                 cache.addAll(files);
//             })
        
//     );
// });

// self.addEventListener("activate",e=>{
//     console.log("Se ha activado el Service Worker");
//     console.log(e);
//     e.respondWith(
//         caches.keys()
//         .then(keys => {
//             console.log(keys); 
//             return Promise.all(keys
//                     .filter(key => key !== name_catch)
//                     .map(key => caches.delete(key)) // borrar los demas
//                 )
//         })

//     )
// });

// self.addEventListener('fetch', e => {
//     console.log('Fetch.. ', e);

//     e.respondWith(
//         caches.match(e.request)
//             .then(respuestaCache => {
//                 return respuestaCache || fetch(e.request);
//             })
//             .catch( () => caches.match('/error.html'))
//     );
// });